# MÃ³dulo de Disparo em Massa - EspecificaÃ§Ã£o Expandida

## 1. VisÃ£o Geral do MÃ³dulo

### 1.1 Objetivo da Tela Separada
Criar uma interface dedicada para configuraÃ§Ã£o, validaÃ§Ã£o e execuÃ§Ã£o de campanhas de disparo em massa, com controles granulares de execuÃ§Ã£o e monitoramento em tempo real.

### 1.2 AnÃ¡lise CrÃ­tica Inicial
*âš ï¸ LimitaÃ§Ãµes Identificadas:*
- *Compliance LGPD*: Disparos em massa podem violar consentimento
- *Rate Limits*: APIs tÃªm limites que podem quebrar campanhas grandes
- *Deliverability*: Alto volume pode prejudicar reputaÃ§Ã£o do domÃ­nio
- *Performance*: Bubble pode ter limitaÃ§Ãµes para processamento massivo
- *Custos*: Disparos grandes podem gerar custos inesperados

## 2. Validador de Listas

### 2.1 Interface de Upload

[Ãrea de Drop/Upload]
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ðŸ“ Arraste seu arquivo aqui        â”‚
â”‚     ou clique para selecionar       â”‚
â”‚                                     â”‚
â”‚  Formatos: CSV, XLSX, TXT           â”‚
â”‚  Limite: 50.000 registros          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


### 2.2 ValidaÃ§Ãµes AutomÃ¡ticas

#### 2.2.1 ValidaÃ§Ãµes de Arquivo
- âœ… Formato do arquivo (CSV, XLSX, TXT)
- âœ… Tamanho mÃ¡ximo (10MB)
- âœ… NÃºmero de registros (mÃ¡x. 50.000)
- âœ… CodificaÃ§Ã£o de caracteres (UTF-8)
- âœ… Campos obrigatÃ³rios (CNPJ, Telefone, Nome)

#### 2.2.2 ValidaÃ§Ã£o de Telefones WhatsApp
javascript
// ValidaÃ§Ã£o em tempo real via WhatsApp Business API
const validateWhatsAppNumber = async (phone) => {
  try {
    const response = await fetch(`${WHATSAPP_API_URL}/phone_number_status`, {
      method: 'POST',
      headers: {
        'Authorization': `Bearer ${WHATSAPP_TOKEN}`,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        phone_number: phone
      })
    });
    
    const data = await response.json();
    return {
      valid: data.valid,
      whatsapp_enabled: data.whatsapp_enabled,
      status: data.status // VALID, INVALID, PROCESSING, RATE_LIMIT
    };
  } catch (error) {
    return { valid: false, error: error.message };
  }
};


*Status de ValidaÃ§Ã£o:*
- ðŸŸ¢ *VÃLIDO + WhatsApp*: NÃºmero ativo com WhatsApp
- ðŸŸ¡ *VÃLIDO - WhatsApp*: NÃºmero vÃ¡lido mas sem WhatsApp
- ðŸ”´ *INVÃLIDO*: NÃºmero inexistente ou formato incorreto
- âš« *BLACKLIST*: NÃºmero na lista de bloqueio
- ðŸŸ  *ERRO*: Falha na validaÃ§Ã£o (API offline, rate limit)

#### 2.2.3 Sistema de Blacklist
*Categorias de Blacklist:*
- ðŸ“Š *Contabilidade*: EscritÃ³rios contÃ¡beis, contadores
- ðŸ›ï¸ *Ã“rgÃ£os PÃºblicos*: Prefeituras, secretarias, autarquias
- ðŸ¥ *Ãrea da SaÃºde*: Hospitais, clÃ­nicas, laboratÃ³rios
- ðŸŽ“ *EducaÃ§Ã£o*: Escolas, universidades, cursos
- ðŸ¦ *Bancos/Financeiras*: InstituiÃ§Ãµes financeiras
- ðŸ“ž *Call Centers*: Empresas de telemarketing
- â›ª *InstituiÃ§Ãµes Religiosas*: Igrejas, templos
- ðŸš« *Opt-out Manual*: NÃºmeros que solicitaram remoÃ§Ã£o

*Base de Dados de Blacklist:*
sql
-- Tabela de Blacklist
phone_blacklist (
  id UUID PRIMARY KEY,
  phone VARCHAR(20) UNIQUE,
  category VARCHAR(50), -- contabilidade, publico, saude, etc
  reason TEXT,
  cnpj VARCHAR(14), -- se aplicÃ¡vel
  company_name VARCHAR(255),
  added_by UUID REFERENCES users(id),
  auto_detected BOOLEAN DEFAULT false,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- Ãndices para performance
CREATE INDEX idx_phone_blacklist_phone ON phone_blacklist(phone);
CREATE INDEX idx_phone_blacklist_category ON phone_blacklist(category);


*âš ï¸ AnÃ¡lise CrÃ­tica - ValidaÃ§Ãµes:*
- *Custo de API*: ValidaÃ§Ã£o WhatsApp custa ~R$0,005 por consulta
- *Rate Limits*: WhatsApp API limita validaÃ§Ãµes (1000/dia em planos bÃ¡sicos)
- *Falsos Positivos*: NÃºmeros podem ter WhatsApp mas estar inativos
- *SoluÃ§Ã£o*: Implementar cache de validaÃ§Ãµes e validaÃ§Ã£o em lotes

### 2.3 RelatÃ³rio de ValidaÃ§Ã£o

ðŸ“Š RelatÃ³rio de ValidaÃ§Ã£o WhatsApp
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Total de registros: 1.500           â”‚
â”‚ ðŸŸ¢ WhatsApp Ativo: 856 (57.1%)     â”‚
â”‚ ðŸŸ¡ VÃ¡lido s/ WhatsApp: 234 (15.6%)  â”‚
â”‚ ðŸ”´ NÃºmeros InvÃ¡lidos: 156 (10.4%)   â”‚
â”‚ âš« Blacklist: 189 (12.6%)           â”‚
â”‚ ðŸŸ  Erro na ValidaÃ§Ã£o: 65 (4.3%)     â”‚
â”‚                                     â”‚
â”‚ ðŸ“‹ Detalhamento Blacklist:          â”‚
â”‚ â€¢ Contabilidade: 89 (47.1%)         â”‚
â”‚ â€¢ Ã“rgÃ£os PÃºblicos: 45 (23.8%)       â”‚
â”‚ â€¢ Ãrea da SaÃºde: 23 (12.2%)         â”‚
â”‚ â€¢ Call Centers: 18 (9.5%)           â”‚
â”‚ â€¢ Opt-out Manual: 14 (7.4%)         â”‚
â”‚                                     â”‚
â”‚ ðŸ’° Custo de ValidaÃ§Ã£o: R$ 7,50      â”‚
â”‚ â±ï¸ Tempo de Processamento: 8min 32s  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[ðŸ“¥ Baixar VÃ¡lidos] [ðŸ” Ver InvÃ¡lidos] [âš™ï¸ Configurar Blacklist] [â–¶ï¸ Prosseguir]


*AÃ§Ãµes DisponÃ­veis:*
- *Baixar VÃ¡lidos*: Export apenas nÃºmeros com WhatsApp ativo
- *Ver InvÃ¡lidos*: Planilha detalhada com motivos de rejeiÃ§Ã£o
- *Configurar Blacklist*: Adicionar/remover categorias personalizadas
- *Revalidar Erros*: Tentar novamente nÃºmeros com erro de API

## 3. ConfiguraÃ§Ã£o de Blacklist

### 3.1 Interface de Gerenciamento

ðŸš« Gerenciamento de Blacklist
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ðŸ“Š EstatÃ­sticas Atuais:             â”‚
â”‚ â€¢ Total bloqueados: 45.892          â”‚
â”‚ â€¢ Adicionados hoje: 23              â”‚
â”‚ â€¢ Categorias ativas: 8              â”‚
â”‚                                     â”‚
â”‚ ðŸŽ¯ Categorias Ativas:               â”‚
â”‚ â˜‘ï¸ Contabilidade (12.445)           â”‚
â”‚ â˜‘ï¸ Ã“rgÃ£os PÃºblicos (8.234)          â”‚
â”‚ â˜‘ï¸ Ãrea da SaÃºde (6.778)            â”‚
â”‚ â˜‘ï¸ Call Centers (5.234)             â”‚
â”‚ â˜‘ï¸ EducaÃ§Ã£o (4.567)                 â”‚
â”‚ â˜‘ï¸ Bancos/Financeiras (3.889)       â”‚
â”‚ â˜‘ï¸ InstituiÃ§Ãµes Religiosas (2.345)  â”‚
â”‚ â˜‘ï¸ Opt-out Manual (2.400)           â”‚
â”‚                                     â”‚
â”‚ [âž• Nova Categoria] [ðŸ“¤ Import] [ðŸ“¥ Export]
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


### 3.2 DetecÃ§Ã£o AutomÃ¡tica por CNAE
javascript
// Mapeamento CNAE -> Categoria Blacklist
const cnaeBlacklist = {
  // Contabilidade
  '6920-6': 'contabilidade', // Atividades de contabilidade
  '6911-2': 'contabilidade', // Atividades jurÃ­dicas
  
  // Ã“rgÃ£os PÃºblicos  
  '8411-6': 'publico', // AdministraÃ§Ã£o pÃºblica geral
  '8412-4': 'publico', // RegulaÃ§Ã£o de atividades de saÃºde
  
  // SaÃºde
  '8610-1': 'saude', // Atividades de atendimento hospitalar
  '8630-5': 'saude', // Atividade mÃ©dica ambulatorial
  
  // EducaÃ§Ã£o
  '8513-9': 'educacao', // Ensino fundamental
  '8520-1': 'educacao', // Ensino mÃ©dio
  
  // Call Centers
  '8220-2': 'callcenter', // Atividades de teleatendimento
  
  // Bancos
  '6421-2': 'financeiro', // Bancos comerciais
  '6422-1': 'financeiro', // Bancos mÃºltiplos
};

const detectBlacklistCategory = (cnae) => {
  return cnaeBlacklist[cnae] || null;
};


### 3.3 Palavras-Chave para DetecÃ§Ã£o
javascript
const blacklistKeywords = {
  contabilidade: [
    'contabil', 'contador', 'contadoria', 'escritorio contabil',
    'assessoria contabil', 'consultoria contabil', 'crc'
  ],
  publico: [
    'prefeitura', 'camara', 'secretaria', 'municipio', 'estado',
    'governo', 'tribunal', 'cartorio', 'detran', 'receita'
  ],
  saude: [
    'hospital', 'clinica', 'laboratorio', 'consultorio', 'pronto socorro',
    'upa', 'sus', 'unimed', 'amil', 'bradesco saude'
  ],
  educacao: [
    'escola', 'colegio', 'universidade', 'faculdade', 'instituto',
    'curso', 'educacional', 'ensino', 'pedagogico'
  ],
  callcenter: [
    'call center', 'teleatendimento', 'telemarketing', 'sac',
    'atendimento', 'contact center', 'outsourcing'
  ]
};


## 4. Cadastro de Campanhas

### 4.1 ConfiguraÃ§Ã£o BÃ¡sica

ðŸ“‹ InformaÃ§Ãµes da Campanha
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Nome da Campanha: [________________] â”‚
â”‚ DescriÃ§Ã£o: [_______________________] â”‚
â”‚ ResponsÃ¡vel: [@usuario]              â”‚
â”‚ Tags: [#vendas] [#prospecÃ§Ã£o]        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


### 4.2 ConfiguraÃ§Ã£o de Canal

ðŸ“± Canal de Disparo
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ (â—) WhatsApp Business               â”‚
â”‚ ( ) SMS (em desenvolvimento)        â”‚
â”‚                                     â”‚
â”‚ ðŸ“Š Limite da Conta WhatsApp:        â”‚
â”‚ â€¢ Mensagens/dia: 1.000             â”‚
â”‚ â€¢ Utilizadas hoje: 234 (23.4%)     â”‚
â”‚ â€¢ DisponÃ­veis: 766                 â”‚
â”‚                                     â”‚
â”‚ âš ï¸ Sua campanha tem 856 contatos    â”‚
â”‚ vÃ¡lidos. SerÃ¡ executada em 1 dia.   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


### 4.3 ConfiguraÃ§Ã£o de Timing

â° ConfiguraÃ§Ãµes de Envio
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ InÃ­cio: [04/07/2025] [09:00]        â”‚
â”‚ Fim: [10/07/2025] [18:00]           â”‚
â”‚                                     â”‚
â”‚ HorÃ¡rio de funcionamento:           â”‚
â”‚ Segunda-Sexta: 08:00 - 18:00        â”‚
â”‚ SÃ¡bado: 08:00 - 12:00               â”‚
â”‚ Domingo: âŒ NÃ£o enviar              â”‚
â”‚                                     â”‚
â”‚ Taxa de envio: [50] msgs/hora       â”‚
â”‚ Intervalo mÃ­nimo: [2] minutos       â”‚
â”‚                                     â”‚
â”‚ ðŸŽ¯ Estimativa de ConclusÃ£o:         â”‚
â”‚ 856 mensagens Ã· 50/hora = 17h 7min  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âš ï¸ WhatsApp Business API Limits:
â€¢ Tier 1: 1K msgs/dia â€¢ Tier 2: 10K msgs/dia
â€¢ VocÃª estÃ¡ no Tier 1 - Upgrade disponÃ­vel


*âš ï¸ AnÃ¡lise CrÃ­tica - Timing:*
- *Rate Limits DinÃ¢micos*: WhatsApp aumenta limites conforme qualidade das mensagens
- *HorÃ¡rio Local*: Sistema deve considerar fuso horÃ¡rio do nÃºmero (DDD)
- *Throttling Inteligente*: Reduzir velocidade se houver muitas falhas
- *Warming Period*: Contas novas precisam de aquecimento gradual

### 4.4 PersonalizaÃ§Ã£o de Mensagem

âœï¸ Editor de Mensagem WhatsApp
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ OlÃ¡! Tudo bem?                      â”‚
â”‚                                     â”‚
â”‚ Sou [SEU_NOME] da [SUA_EMPRESA].    â”‚
â”‚ Vi que a {{nome_fantasia}} atua no  â”‚
â”‚ setor de {{setor}} em {{cidade}}.   â”‚
â”‚                                     â”‚
â”‚ Temos uma soluÃ§Ã£o que pode ajudar   â”‚
â”‚ empresas como a de vocÃªs...         â”‚
â”‚                                     â”‚
â”‚ ðŸ“± Caracteres: 287/1024            â”‚
â”‚ ðŸ’° Custo estimado: R$ 428,00        â”‚
â”‚                                     â”‚
â”‚ VariÃ¡veis disponÃ­veis:              â”‚
â”‚ â€¢ {{cnpj}} - 12.345.678/0001-90     â”‚
â”‚ â€¢ {{razao_social}} - Empresa Ltda   â”‚
â”‚ â€¢ {{nome_fantasia}} - Loja Central  â”‚
â”‚ â€¢ {{setor}} - Varejo                â”‚
â”‚ â€¢ {{cidade}} - SÃ£o Paulo            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[ðŸ‘ï¸ PrÃ©-visualizar] [ðŸ“± Testar Envio] [ðŸ’¾ Salvar Template]

âš ï¸ Dicas para WhatsApp Business:
â€¢ Use linguagem natural e pessoal
â€¢ Evite CAPS LOCK e excesso de emojis  
â€¢ Inclua identificaÃ§Ã£o clara da empresa
â€¢ Mensagens muito longas podem ser cortadas


## 5. Sistema de ExecuÃ§Ã£o e Monitoramento

### 5.1 Dashboard de Campanha Ativa

ðŸš€ Campanha: "ProspecÃ§Ã£o Julho 2025"
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Status: ðŸŸ¡ Executando               â”‚
â”‚ Progresso: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘ 68%          â”‚
â”‚                                     â”‚
â”‚ ðŸ“Š MÃ©tricas WhatsApp:               â”‚
â”‚ â€¢ Total vÃ¡lidos: 856                â”‚
â”‚ â€¢ Enviadas: 582                     â”‚
â”‚ â€¢ Entregues: 567 (97.4%)            â”‚
â”‚ â€¢ Lidas: 234 (41.3%)                â”‚
â”‚ â€¢ Respondidas: 28 (4.9%)            â”‚
â”‚ â€¢ Falharam: 15 (2.6%)               â”‚
â”‚                                     â”‚
â”‚ â±ï¸ Timing:                          â”‚
â”‚ â€¢ Pendentes: 274                    â”‚
â”‚ â€¢ ConclusÃ£o: 5h 28min               â”‚
â”‚ â€¢ Velocidade: 52 msgs/hora          â”‚
â”‚                                     â”‚
â”‚ ðŸ’° Custos:                          â”‚
â”‚ â€¢ ValidaÃ§Ã£o: R$ 4,28                â”‚
â”‚ â€¢ Envios: R$ 291,00                 â”‚
â”‚ â€¢ Total: R$ 295,28                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[â¸ï¸ Pausar] [â¹ï¸ Parar] [ðŸ“Š Detalhes] [ðŸ“¥ Respostas]


### 4.2 Controles de ExecuÃ§Ã£o

#### 4.2.1 Pausar Campanha

â¸ï¸ Pausar Campanha
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ A campanha serÃ¡ pausada apÃ³s o      â”‚
â”‚ envio atual ser concluÃ­do.          â”‚
â”‚                                     â”‚
â”‚ Mensagens na fila: 398              â”‚
â”‚ Tempo para pausa: ~2 minutos        â”‚
â”‚                                     â”‚
â”‚ [Pausar Agora] [Cancelar]           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


#### 4.2.2 Parar Campanha

â¹ï¸ Parar Campanha
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âš ï¸ ATENÃ‡ÃƒO: Esta aÃ§Ã£o Ã© irreversÃ­vel â”‚
â”‚                                     â”‚
â”‚ A campanha serÃ¡ interrompida        â”‚
â”‚ imediatamente. Mensagens pendentes  â”‚
â”‚ NÃƒO serÃ£o enviadas.                 â”‚
â”‚                                     â”‚
â”‚ Mensagens que serÃ£o perdidas: 398   â”‚
â”‚                                     â”‚
â”‚ Motivo da interrupÃ§Ã£o:              â”‚
â”‚ [_________________________________] â”‚
â”‚                                     â”‚
â”‚ [Confirmar Parada] [Cancelar]       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


*âš ï¸ AnÃ¡lise CrÃ­tica - Controles:*
- *Problema*: Pausa pode nÃ£o ser imediata devido a processamento assÃ­ncrono
- *SoluÃ§Ã£o*: Implementar flag de controle verificada a cada iteraÃ§Ã£o
- *Problema*: Bubble pode nÃ£o suportar processamento em background
- *SoluÃ§Ã£o*: Usar Supabase Functions ou webhooks para processamento

### 4.3 Logs Detalhados

ðŸ“‹ Log de ExecuÃ§Ã£o
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 14:23:45 | âœ… | 11987654321 | Enviado
â”‚ 14:23:47 | âŒ | 11999888777 | NÃºmero invÃ¡lido
â”‚ 14:23:49 | âœ… | 11955443322 | Enviado
â”‚ 14:23:51 | â³ | 11944332211 | Processando
â”‚ 14:23:53 | âœ… | 11933221100 | Enviado
â”‚                                     â”‚
â”‚ Filtros: [Todos] [Sucesso] [Erro]   â”‚
â”‚ Buscar: [________________] [ðŸ”]      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[Exportar Logs] [Reprocessar Erros]


## 5. Estrutura de Dados Expandida

### 5.1 Tabelas Novas
sql
-- Campanhas de Disparo
mass_campaigns (
  id UUID PRIMARY KEY,
  user_id UUID REFERENCES users(id),
  name VARCHAR(255) NOT NULL,
  description TEXT,
  channel VARCHAR(50), -- whatsapp, email, sms
  message_template TEXT,
  status VARCHAR(50), -- draft, validating, scheduled, running, paused, completed, stopped
  total_records INTEGER,
  sent_count INTEGER DEFAULT 0,
  success_count INTEGER DEFAULT 0,
  error_count INTEGER DEFAULT 0,
  send_rate INTEGER DEFAULT 50, -- msgs per hour
  start_time TIMESTAMPTZ,
  end_time TIMESTAMPTZ,
  working_hours JSONB, -- horÃ¡rios de funcionamento
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- Lista de Contatos da Campanha
campaign_contacts (
  id UUID PRIMARY KEY,
  campaign_id UUID REFERENCES mass_campaigns(id),
  cnpj VARCHAR(14),
  razao_social VARCHAR(255),
  nome_fantasia VARCHAR(255),
  phone VARCHAR(20),
  setor VARCHAR(100),
  cidade VARCHAR(100),
  custom_data JSONB, -- dados personalizados da planilha
  
  -- Status de ValidaÃ§Ã£o WhatsApp
  phone_validation_status VARCHAR(50), -- valid_whatsapp, valid_no_whatsapp, invalid, blacklisted, error
  whatsapp_enabled BOOLEAN DEFAULT false,
  blacklist_category VARCHAR(50), -- contabilidade, publico, saude, callcenter, optout
  blacklist_reason TEXT,
  validation_timestamp TIMESTAMPTZ,
  validation_cost DECIMAL(10,4), -- custo da validaÃ§Ã£o em reais
  
  -- Status de Envio
  send_status VARCHAR(50), -- pending, sent, delivered, read, replied, failed
  send_timestamp TIMESTAMPTZ,
  delivery_timestamp TIMESTAMPTZ,
  read_timestamp TIMESTAMPTZ,
  reply_timestamp TIMESTAMPTZ,
  error_message TEXT,
  
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- ValidaÃ§Ã£o de Listas
list_validations (
  id UUID PRIMARY KEY,
  campaign_id UUID REFERENCES mass_campaigns(id),
  filename VARCHAR(255),
  total_records INTEGER,
  valid_records INTEGER,
  invalid_records INTEGER,
  validation_report JSONB,
  status VARCHAR(50), -- processing, completed, failed
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- Logs de ExecuÃ§Ã£o
campaign_logs (
  id UUID PRIMARY KEY,
  campaign_id UUID REFERENCES mass_campaigns(id),
  contact_id UUID REFERENCES campaign_contacts(id),
  event_type VARCHAR(50), -- sent, delivered, read, replied, failed, paused, stopped
  message TEXT,
  metadata JSONB,
  timestamp TIMESTAMPTZ DEFAULT NOW()
);


## 6. Fluxos de NavegaÃ§Ã£o

### 6.1 Fluxo de CriaÃ§Ã£o de Campanha

1. Dashboard â†’ [Novo Disparo em Massa]
2. Upload de Lista â†’ ValidaÃ§Ã£o AutomÃ¡tica
3. CorreÃ§Ã£o de Erros (se necessÃ¡rio)
4. ConfiguraÃ§Ã£o da Campanha
5. CriaÃ§Ã£o da Mensagem
6. Teste de Envio
7. Agendamento/ExecuÃ§Ã£o


### 6.2 Fluxo de Monitoramento

1. Dashboard â†’ [Campanhas Ativas]
2. SeleÃ§Ã£o da Campanha
3. VisualizaÃ§Ã£o de MÃ©tricas
4. AÃ§Ãµes de Controle (Pausar/Parar)
5. AnÃ¡lise de Logs
6. ExportaÃ§Ã£o de RelatÃ³rios


## 7. ConsideraÃ§Ãµes de ImplementaÃ§Ã£o

### 7.1 LimitaÃ§Ãµes do Bubble
*âš ï¸ Problemas Identificados:*
- *Processamento em Lote*: Bubble nÃ£o Ã© ideal para processamento massivo
- *Timeouts*: Requests podem dar timeout em listas grandes
- *Concurrent Users*: Performance degrada com muitos usuÃ¡rios simultÃ¢neos

*ðŸ’¡ SoluÃ§Ãµes Propostas:*
- *Backend HÃ­brido*: Usar Supabase Edge Functions para processamento pesado
- *Queue System*: Implementar fila de processamento assÃ­ncrono
- *Chunking*: Dividir listas grandes em lotes menores

### 7.2 IntegraÃ§Ãµes CrÃ­ticas
javascript
// Exemplo de integraÃ§Ã£o com WhatsApp Business API
const sendWhatsAppMessage = async (contact, message) => {
  try {
    const response = await fetch(`${WHATSAPP_API_URL}/messages`, {
      method: 'POST',
      headers: {
        'Authorization': `Bearer ${WHATSAPP_TOKEN}`,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        messaging_product: 'whatsapp',
        to: contact.phone,
        type: 'text',
        text: { body: personalizeMessage(message, contact) }
      })
    });
    
    if (!response.ok) throw new Error(`HTTP ${response.status}`);
    return await response.json();
    
  } catch (error) {
    console.error('WhatsApp send error:', error);
    throw error;
  }
};


### 7.3 Compliance e SeguranÃ§a
*ðŸ“‹ Checklist LGPD:*
- [ ] Verificar consentimento antes do envio
- [ ] Implementar opt-out automÃ¡tico
- [ ] Logs de auditoria para todas as aÃ§Ãµes
- [ ] Criptografia de dados sensÃ­veis
- [ ] RetenÃ§Ã£o limitada de dados pessoais

## 8. MÃ©tricas de Sucesso

### 8.1 KPIs Operacionais
- *Taxa de Entrega*: > 95%
- *Taxa de Erro*: < 5%
- *Tempo de Processamento*: < 2min por 1000 registros
- *Uptime*: > 99.5%

### 8.2 KPIs de NegÃ³cio
- *Taxa de Resposta*: > 3%
- *Leads Qualificados*: > 15% das respostas
- *ROI da Campanha*: > 200%
- *Tempo de Setup*: < 30min por campanha

## 9. PrÃ³ximos Passos

### 9.1 ValidaÃ§Ã£o TÃ©cnica
- [ ] Testes de carga com APIs externas
- [ ] Prototipo de processamento assÃ­ncrono
- [ ] ValidaÃ§Ã£o de limites do Bubble
- [ ] AnÃ¡lise de custos por volume

### 9.2 ValidaÃ§Ã£o JurÃ­dica
- [ ] RevisÃ£o compliance LGPD
- [ ] PolÃ­tica de uso aceitÃ¡vel
- [ ] Termos de responsabilidade
- [ ] Procedimentos de opt-out

---

*âš ï¸ ConsideraÃ§Ãµes Finais:*

Este mÃ³dulo adiciona complexidade significativa ao sistema. Recomendo uma abordagem incremental:

1. *MVP*: Validador simples + disparo bÃ¡sico
2. *V2*: Controles avanÃ§ados + monitoramento
3. *V3*: Analytics avanÃ§ados + otimizaÃ§Ãµes

A gamificaÃ§Ã£o pode ser prejudicada se o foco mudar para volume vs. qualidade. Considere mÃ©tricas balanceadas que premiem tanto quantidade quanto qualidade dos leads gerados.